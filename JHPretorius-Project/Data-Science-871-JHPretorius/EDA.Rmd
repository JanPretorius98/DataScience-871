---
title: "Data-Science-871-JHPretorius-WriteUp"
author: "JH Pretorius"
date: "2023-05-24"
output: html_document
Goal: "Threefold: (1) Transformation and cleaning of data. (2) Exploratory Data Analysis of Dating Site Data. (3) Machine Learning modelling."
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Preface

```{r housekeeping, warning = FALSE}
# Clear environment
rm(list = ls())

# Load packages in use
pacman::p_load(dplyr, ggplot2, tidyverse, rsample, caret, glmnet, vip, pdp, stringr, 
               tidytext, emoji, stopwords)

# Define plot themes and palettes
palette <- c("#29066b", "#71016d", "#a5206b", "#cc4868", "#ea7369")

th <- theme(legend.position = "bottom",
            panel.background = element_blank(),
            plot.background = element_rect(fill = "white", color = "white"),
            panel.grid.major = element_line(color="#808080", size = 0.1),
            panel.grid.minor = element_line(color="#808080", size = 0.1),
            axis.title.x=element_text(colour="black", size = 12,
                                      family = "arial", vjust=-2,hjust=0.5),
            axis.title.y=element_text(colour="black", size = 12,
                                      family = "arial",vjust = 3,hjust=0.5),
            axis.text.y=element_text(colour ="black", size = 10, 
                                     family = "arial"),
            axis.text.x=element_text(colour="black", size = 10,
                                     family = "arial"),
            plot.margin = unit(c(0.5,0.5,0.5,0.5), "cm"),
            plot.title = element_text(colour="black", size = 16,
                                      family = "arial",hjust=0.5, face = "bold"),
            plot.subtitle = element_text(colour="black", size = 14,
                                         family = "arial"),
            plot.caption = element_text(colour="black", size = 10,
                                        family = "arial"),
            legend.text = element_text(colour="black", size = 12,
                                       family = "arial"),
            legend.title = element_text(colour="black", size = 12,
                                        family = "arial", hjust=3, face = "bold"),
            axis.ticks = element_blank(),
            strip.text = element_text(colour="black", size = 12,
                                      family = "arial", vjust=1,hjust=0.5))

# Import data
path <- "/Users/janhendrikpretorius/Library/CloudStorage/OneDrive-StellenboschUniversity/Masters-2023/Modules/Data Science/DataScience-871-repo/JHPretorius-Project/Candidate Data Sets/Dating/"
file <- "lovoo_v3_users_api-results.csv"

df <- read_csv(paste0(path, file))

```

# Introduction

In this project, my aim is to uncover the defining characteristics that contribute to an individual's attractiveness, popularity, and fame. My strategy involves using data from Lovoo, a European dating site/app, which is available through [Kaggle](https://www.kaggle.com/datasets/utkarshx27/lovoo-dating-app-dataset?select=lovoo_v3_users_api-results.csv). Driven by a keen interest to understand behavioural traits beyond mere physical attractiveness, I am determined to reveal hidden attributes that potentially shape interpersonal interactions within the sphere of a dating app environment. Dating site behaviour carries relevance even in economic circles, as an understanding of this paradigm may be used to bolster economic models to study relationship initiation as an analytic framework to explain overall mate-selection behavior.

The analysis commences with the transformation of raw data into a more insightful format, by creating additional variables designed to enhance the predictive power of subsequent statistical models. This process allows me to delve into an exploratory role, as I sift through the data in search of characteristics that could indicate valuable predictive variables. The goal is not just to understand but to forecast which factors lead to an increased number of profile views and 'likes' received.

To this end, I construct a random forest model, a powerful tool in discerning the intricate characteristics that influence human behaviour. The model functions as a compass, guiding me towards a deeper understanding of the underpinnings of attraction, popularity, and fame in the digital dating landscape.

# Part 1: Transformation and Cleaning

The data contain around 40 different variables, containing information on a particular profile and other demographics. An extract of the data is included below, along with Table 1 that describes some of the relevant variables. The data set only contains data on individuals that identify as female. To this end, I am essentially attempting to understand which factors determine the behaviour of individuals interested in females.

### Head of dataframe

```{r echo=FALSE}
head(df)
```

### Table 1

| Variable             | Description                                                                                                                                 |
|-----------------------|------------------------------------------------|
| genderLooking        | Preferred gender the subject is looking to engage with. Represented as 'M' for male, 'F' for female, 'both' for male and female, or 'none'. |
| age                  | Age of the individual.                                                                                                                      |
| counts_details       | How complete the profile is. Proportion of detail in the account. Measured from 0.0-1.0.                                                    |
| counts_pictures      | How many pictures does the profile contain.                                                                                                 |
| counts_profileVisits | How many times the profile has been viewed.                                                                                                 |
| counts_kisses        | Number of 'kisses' or 'likes' received by profile.                                                                                          |
| flirtInterests\_\*   | What the individual is interested in. \* represents: 'chat', 'date', 'friends'.                                                             |
| verified             | Whether the profile has been verified or not.                                                                                               |
| lang_count           | Number of languages spoken by an individual.                                                                                                |
| lang\_\*             | Language spoken by an individual. \* represents: 'en' (English), 'de' (German), 'fr' (French), 'it' (Italian), 'es' (Spanish).              |
| whazzup              | A phrase that represents the profile's 'bio'.                                                                                               |

The raw data is already very useable, but some new variables must be added to produce better models. The first data transformation is to consider the language used by individuals in their profiles. To this end, there are two main operations when discerning the effect of language use on individual behaviour: words used in biographies, and emoji use. Both these factors may reveal characteristics underlying confidence and perceived desirability.

The code chunk below creates two new dummy variables, `has_emoji` and `contains_popular_word`. `has_emoji` attributes a '1' based on whether `wazzup` contains an emoji. `contains_popular_word` attributes a '1' based on whether `wazzup` contains a popular word. The code chunk also outputs which words are the most popular.

```{r words}

# Define dummy variable that detects presence of emojis
df <- df %>%
  mutate(has_emoji = ifelse(emoji_detect(whazzup), 1, 0))

# Get the most used words in profile
# First, create a table of words with the corresponding counts_profileVisits
words_visits <- df %>%
  unnest_tokens(word, whazzup) %>%
  mutate(word = str_remove_all(word, "[[:digit:]]+")) %>%
  select(word, counts_profileVisits)

# Then calculate the mean counts_profileVisits for each word and its count
words <- words_visits %>%
  group_by(word) %>%
  summarise(mean_profileVisits = mean(counts_profileVisits, na.rm = TRUE),
            word_count = n(), 
            .groups = "drop")

# Create word popularity index and determine popular words
words <- words %>%
  mutate(popularity_index = 0.8 * word_count + 0.2 * mean_profileVisits) %>% 
  filter(popularity_index > 200 & word_count > 10, 
         word != "", 
         !is.na(word), 
         !is.na(mean_profileVisits), 
         !is.na(word_count), 
         !is.na(popularity_index)) %>%
  filter(!word %in% stopwords::stopwords("de")) %>%
  filter(!word %in% stopwords::stopwords("en"))

# Create a single pattern string that matches any word in words$word
words_pattern <- paste(words$word, collapse = "|")

# Add the new variable to df
df <- df %>%
  mutate(contains_popular_word = ifelse(str_detect(whazzup, words_pattern), 1, 0)) %>%
  mutate(
    contains_popular_word = replace_na(contains_popular_word, 0),
    has_emoji = replace_na(has_emoji, 0)
  )

words <- words %>%
  arrange(desc(popularity_index)) %>% 
  select(c(word, popularity_index))

head(words)
```

A final operation pertains to the time an individual is online. I add a new dummy variable called `night_owl` to the dataframe that assigns a '1' based on whether a person was online at night or not. The motivation behind this is that dating apps tend to be more popular in the evenings, than during daytime.

```{r, warning=FALSE}
df <- df %>%
  mutate(night_owl = ifelse(hour(hms(substr(lastOnlineDate, 12, 19))) > 18 | 
                            hour(hms(substr(lastOnlineDate, 12, 19))) < 6, 1, 0))

```

#   Part 2: Exploratory Data Analysis
